// Generated by CoffeeScript 1.4.0
var activeTile, layersElement, map, refreshLayers, tileset;

$("<div id='tiles'>").appendTo("body");

layersElement = $("<div id='layers'>").appendTo("body");

5..times(function() {
  return layersElement.append("<textarea>");
});

map = Map();

tileset = Tileset(function() {
  tileset.render();
  return map.tiles(tileset.tiles());
});

$(document).bind("keydown", "=", function() {
  return tiler.changePage(+1);
});

$(document).bind("keydown", "-", function() {
  return tiler.changePage(-1);
});

$(document).bind("keydown", "s", function() {
  return map.saveLayerData();
});

activeTile = null;

refreshLayers = function() {
  var data;
  data = $("#layers textarea").map(function() {
    return $(this).val();
  }).get();
  return map.loadLayers(data);
};

$(document).on({
  keyup: refreshLayers,
  blur: refreshLayers
}, "#layers textarea");

$(document).on({
  mousedown: function(e) {
    var sha;
    sha = $(this).attr("src").split("/").last();
    activeTile = tileset.lookup(sha);
    $("#props").val(Util.toCSON(activeTile));
    return false;
  }
}, "#tiles img");

$("<textarea id='props'>").appendTo("body");

$("#props").on({
  blur: function() {
    var code, data, val;
    val = $(this).val();
    code = CoffeeScript.compile(val, {
      bare: true
    });
    data = eval(code);
    return Object.extend(activeTile, data);
  }
});
