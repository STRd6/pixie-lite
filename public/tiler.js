// Generated by CoffeeScript 1.4.0
var layersElement, map, refreshLayers, tileProps, tileset;

$("<div id='tiles'>").appendTo("body");

$("<div id='coolTiles'>").appendTo("body");

layersElement = $("<div id='layers'>").appendTo("body");

5..times(function() {
  return layersElement.append("<textarea>");
});

map = Map();

tileset = Tileset(function() {
  tileset.render();
  return map.tiles(tileset.tiles());
});

$(document).bind("keydown", "=", function() {
  return tiler.changePage(+1);
});

$(document).bind("keydown", "-", function() {
  return tiler.changePage(-1);
});

$(document).bind("keydown", "s", function() {
  return map.saveLayerData();
});

tileProps = {
  "default": {
    hflip: false,
    offset: 0
  }
};

window.saveTilesets = function() {
  var n, tree;
  tree = {};
  n = 0;
  Storage.list("tiles").eachSlice(113, function(shas) {
    tree["tileset" + n] = CAS.storeJSON(shas);
    return n += 1;
  });
  return Storage.mergeTree(tree);
};

refreshLayers = function() {
  var data;
  data = $("#layers textarea").map(function() {
    return $(this).val();
  }).get();
  return map.loadLayers(data);
};

$(document).on({
  keyup: refreshLayers,
  blur: refreshLayers
}, "#layers textarea");

$(document).on({
  mousedown: function(e) {
    $(this).appendTo("#coolTiles");
    return false;
  }
}, "#tiles img");

$(document).on({
  mousedown: function(e) {
    $(this).appendTo("#tiles");
    return false;
  }
}, "#coolTiles img");
