// Generated by CoffeeScript 1.4.0
var activeTile, layersElement, map, refreshLayers, tileset;

UI.buttons({
  Save: function() {
    tileset.save();
    return map.saveLayerData();
  }
});

$("<div id='tiles'>").appendTo("body");

layersElement = $("<div id='layers'>").appendTo("body");

5..times(function() {
  return layersElement.append("<textarea>");
});

map = Map();

tileset = Tileset(function() {
  tileset.render();
  return map.tiles(tileset.tiles());
});

activeTile = null;

refreshLayers = function() {
  var data;
  data = $("#layers textarea").map(function() {
    return $(this).val();
  }).get();
  return map.loadLayers(data);
};

$(document).on({
  keyup: refreshLayers,
  blur: refreshLayers
}, "#layers textarea");

$(document).on({
  mousedown: function(e) {
    activeTile = tileset.get($(this).index());
    $("#props").val(Util.toCSON(activeTile));
    return false;
  }
}, "#tiles img");

$("<textarea id='props'>").appendTo("body");

$("#props").on({
  blur: function() {
    var code, data, val;
    val = $(this).val();
    code = CoffeeScript.compile(val, {
      bare: true
    });
    data = eval(code);
    return Object.extend(activeTile, data);
  }
});

UI.actions({
  "[": function() {
    return map.changeCameraAngle((-1 / 4).turns);
  },
  "]": function() {
    return map.changeCameraAngle((+1 / 4).turns);
  },
  "up": function() {
    return map.changeTopLayer(+1);
  },
  "down": function() {
    return map.changeTopLayer(-1);
  }
});
